        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>serialization Library / Dart API Reference</title>
        <link rel="stylesheet" type="text/css"
            href="styles.css">
        <link href="http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="favicon.ico">
        
        <link rel="stylesheet" type="text/css"
            href="apidoc-styles.css" />
        
        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(["_setAccount", "UA-26406144-9"]);
          _gaq.push(["_trackPageview"]);

          (function() {
            var ga = document.createElement("script");
            ga.type = "text/javascript"; ga.async = true;
            ga.src = ("https:" == document.location.protocol ?
              "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(ga, s);
          })();
        </script>
        
        </head>
        <body data-library="serialization">
        <div class="page">
        <div class="header">
          <a href="http://dartlang.org" ref="external"><div class="logo"></div></a>
          <a href="index.html">Dart API Reference</a>
         &rsaquo; <a href="serialization.html">serialization</a>        <form action="http://www.dartlang.org/search.html" id="search-box">
          <input type="hidden" name="cx" value="011220921317074318178:i4mscbaxtru">
          <input type="hidden" name="ie" value="UTF-8">
          <input type="hidden" name="hl" value="en">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </form>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
<h2><div class="icon-library"></div><a href="args.html">args</a></h2><h2><div class="icon-library"></div><a href="dart_async.html">dart:async</a></h2><h2><div class="icon-library"></div><a href="dart_chrome.html">dart:chrome</a></h2><h2><div class="icon-library"></div><a href="dart_collection.html">dart:collection</a></h2><h2><div class="icon-library"></div><a href="dart_core.html">dart:core</a></h2><h2><div class="icon-library"></div><a href="dart_crypto.html">dart:crypto</a></h2><h2><div class="icon-library"></div><a href="dart_html.html">dart:html</a></h2><h2><div class="icon-library"></div><a href="dart_indexed_db.html">dart:indexed_db</a></h2><h2><div class="icon-library"></div><a href="dart_io.html">dart:io</a></h2><h2><div class="icon-library"></div><a href="dart_isolate.html">dart:isolate</a></h2><h2><div class="icon-library"></div><a href="dart_json.html">dart:json</a></h2><h2><div class="icon-library"></div><a href="dart_math.html">dart:math</a></h2><h2><div class="icon-library"></div><a href="dart_mirrors.html">dart:mirrors</a></h2><h2><div class="icon-library"></div><a href="dart_scalarlist.html">dart:scalarlist</a></h2><h2><div class="icon-library"></div><a href="dart_svg.html">dart:svg</a></h2><h2><div class="icon-library"></div><a href="dart_uri.html">dart:uri</a></h2><h2><div class="icon-library"></div><a href="dart_utf.html">dart:utf</a></h2><h2><div class="icon-library"></div><a href="dart_web_audio.html">dart:web_audio</a></h2><h2><div class="icon-library"></div><a href="dart_web_sql.html">dart:web_sql</a></h2><h2><div class="icon-library"></div><a href="fixnum.html">fixnum</a></h2><h2><div class="icon-library"></div><a href="intl.html">intl</a></h2><h2><div class="icon-library"></div><a href="logging.html">logging</a></h2><h2><div class="icon-library"></div><a href="matcher.html">matcher</a></h2><h2><div class="icon-library"></div><a href="meta.html">meta</a></h2><h2><div class="icon-library"></div><a href="mock.html">mock</a></h2><h2><div class="icon-library"></div><a href="scheduled_test.html">scheduled_test</a></h2><h2><div class="icon-library"></div><strong>serialization</strong></h2><ul class="icon">
<li><a href="serialization/BasicRule.html"><div class="icon-class"></div>BasicRule</a></li>
<li><a href="serialization/ClosureRule.html"><div class="icon-class"></div>ClosureRule</a></li>
<li><a href="serialization/Constructor.html"><div class="icon-class"></div>Constructor</a></li>
<li><a href="serialization/ConstructType.html"><div class="icon-interface"></div>ConstructType</a></li>
<li><a href="serialization/CustomRule.html"><div class="icon-class"></div>CustomRule</a></li>
<li><a href="serialization/DesignatedRuleForObject.html"><div class="icon-class"></div>DesignatedRuleForObject</a></li>
<li><a href="serialization/Format.html"><div class="icon-class"></div>Format</a></li>
<li><a href="serialization/GetStateType.html"><div class="icon-interface"></div>GetStateType</a></li>
<li><a href="serialization/ListRule.html"><div class="icon-class"></div>ListRule</a></li>
<li><a href="serialization/ListRuleEssential.html"><div class="icon-class"></div>ListRuleEssential</a></li>
<li><a href="serialization/MapRule.html"><div class="icon-class"></div>MapRule</a></li>
<li><a href="serialization/MirrorRule.html"><div class="icon-class"></div>MirrorRule</a></li>
<li><a href="serialization/NamedObjectRule.html"><div class="icon-class"></div>NamedObjectRule</a></li>
<li><a href="serialization/NonEssentialStateType.html"><div class="icon-interface"></div>NonEssentialStateType</a></li>
<li><a href="serialization/PrimitiveRule.html"><div class="icon-class"></div>PrimitiveRule</a></li>
<li><a href="serialization/Reader.html"><div class="icon-class"></div>Reader</a></li>
<li><a href="serialization/ReaderOrWriter.html"><div class="icon-class"></div>ReaderOrWriter</a></li>
<li><a href="serialization/Reference.html"><div class="icon-class"></div>Reference</a></li>
<li><a href="serialization/Serialization.html"><div class="icon-class"></div>Serialization</a></li>
<li><a href="serialization/SerializationRule.html"><div class="icon-class"></div>SerializationRule</a></li>
<li><a href="serialization/SetWithFunction.html"><div class="icon-interface"></div>SetWithFunction</a></li>
<li><a href="serialization/SimpleFlatFormat.html"><div class="icon-class"></div>SimpleFlatFormat</a></li>
<li><a href="serialization/SimpleJsonFormat.html"><div class="icon-class"></div>SimpleJsonFormat</a></li>
<li><a href="serialization/SimpleMapFormat.html"><div class="icon-class"></div>SimpleMapFormat</a></li>
<li><a href="serialization/Trace.html"><div class="icon-class"></div>Trace</a></li>
<li><a href="serialization/Writer.html"><div class="icon-class"></div>Writer</a></li>
<li><a href="serialization/SerializationException.html"><div class="icon-exception"></div>SerializationException</a></li>
</ul>
<h2><div class="icon-library"></div><a href="unittest.html">unittest</a></h2></div>
<div class="content">
<h2><strong>serialization</strong> library</h2>
<div class="doc"><p>This provides a general-purpose serialization facility for Dart objects. A
<a class="crossref" href="serialization/Serialization.html">Serialization</a> is defined in terms of <a class="crossref" href="serialization/SerializationRule.html">SerializationRule</a>s and supports
reading and writing to different formats.</p>
<h1>Setup</h1>
<p>A simple example of usage is</p>
<pre><code> var address = new Address();
 address.street = 'N 34th';
 address.city = 'Seattle';
 var serialization = new Serialization()
     ..addRuleFor(address);
 String output = serialization.write(address);
</code></pre>
<p>This creates a new serialization and adds a rule for address objects. Right
now it has to be passed an address instance because of limitations using
Address as a literal. Then we ask the Serialization to write the address
and we get back a Map which is a <code>json</code>able representation of the state of
the address and related objects.</p>
<p>The version above used reflection to automatically identify the public
fields of the address object. We can also specify those fields explicitly.</p>
<pre><code> var serialization = new Serialization()
   ..addRuleFor(address,
       constructor: "create",
       constructorFields: ["number", "street"],
       fields: ["city"]);
</code></pre>
<p>This rule still uses reflection to access the fields, but does not try to
identify which fields to use, but instead uses only the "number" and "street"
fields that we specified. We may also want to tell it to identify the
fields, but to specifically omit certain fields that we don't want
serialized.</p>
<pre><code> var serialization = new Serialization()
   ..addRuleFor(address,
       constructor: "",
       excludeFields: ["other", "stuff"]);
</code></pre>
<h1>Writing Rules</h1>
<p>We can also use a completely non-reflective rule to serialize and
de-serialize objects. This can be more work, but it does work in
dart2js, where mirrors are not yet implemented. We can specify this in two
ways. First, we can write our own SerializationRule class that has methods
for our Address class.</p>
<pre><code> class AddressRule extends CustomRule {
   bool appliesTo(instance, Writer w) =&gt; instance.runtimeType == Address;
   getState(instance) =&gt; [instance.street, instance.city];
   create(state) =&gt; new Address();
   setState(Address a, List state) {
     a.street = state[0];
     a.city = state[1];
   }
 }
</code></pre>
<p>The class needs four different methods. The <code>appliesTo</code> method tells us if
the rule should be used to write an object. In this example we use a test
based on runtimeType. We could also use an "is Address" test, but if Address
has subclasses that would find those as well, and we want a separate rule
for each. The <code>getState</code> method should
return all the state of the object that we want to recreate,
and should be either a Map or a List. If you want to write to human-readable
formats where it's useful to be able to look at the data as a map from
field names to values, then it's better to return it as a map. Otherwise it's
more efficient to return it as a list. You just need to be sure that the
<code>create</code> and <code>setState</code> methods interpret the same way as <code>getState</code> does.</p>
<p>The <code>create</code> method will create the new object and return it. While it's
possible to create the object and set all its state in this one method, that
increases the likelihood of problems with cycles. So it's better to use the
minimum necessary information in <code>create</code> and do more of the work in
<code>setState</code>.</p>
<p>The other way to do this is not creating a subclass, but by using a
<a class="crossref" href="serialization/ClosureRule.html">ClosureRule</a> and giving it functions for how to create
the address.</p>
<pre><code> addressToMap(a) =&gt; {"number" : a.number, "street" : a.street,
     "city" : a.city};
 createAddress(Map m) =&gt; new Address.create(m["number"], m["street"]);
 fillInAddress(Address a, Map m) =&gt; a.city = m["city"];
 var serialization = new Serialization()
   ..addRule(
       new ClosureRule(anAddress.runtimeType,
           addressToMap, createAddress, fillInAddress);
</code></pre>
<p>In this case we have created standalone functions rather than
methods in a subclass and we pass them to the constructor of
<a class="crossref" href="serialization/ClosureRule.html">ClosureRule</a>. In this case we've also had them use maps rather than
lists for the state, but either would work as long as the rule is
consistent with the representation it uses. We pass it the runtimeType
of the object, and functions equivalent to the methods on <a class="crossref" href="serialization/CustomRule.html">CustomRule</a></p>
<h1>Constant Values</h1>
<p>There are cases where the constructor needs values that we can't easily get
from the serialized object. For example, we may just want to pass null, or a
constant value. To support this, we can specify as constructor fields
values that aren't field names. If any value isn't a String, or is a string
that doesn't correspond to a field name, it will be
treated as a constant and passed unaltered to the constructor.</p>
<p>In some cases a non-constructor field should not be set using field
access or a setter, but should be done by calling a method. For example, it
may not be possible to set a List field "foo", and you need to call an
addFoo() method for each entry in the list. In these cases, if you are using
a BasicRule for the object you can call the setFieldWith() method.</p>
<pre><code>  s..addRuleFor(fooHolderInstance).setFieldWith("foo",
      (parent, value) =&gt; for (var each in value) parent.addFoo(value));
</code></pre>
<h1>Writing</h1>
<p>To write objects, we use the write() method.</p>
<pre><code>  var output = serialization.write(someObject);
</code></pre>
<p>By default this uses a representation in which objects are represented as
maps keyed by field name, but in which references between objects have been
converted into Reference objects. This is then typically encoded as
a <code>json</code> string, but can also be used in other ways, e.g. sent to another
isolate.</p>
<p>We can write objects in different formats by passing a <a class="crossref" href="serialization/Format.html">Format</a> object to
the <code>write</code> method or by getting a <a class="crossref" href="serialization/Writer.html">Writer</a> object. The available formats
include the default, a simple "flat" format that doesn't include field names,
and a simple JSON format that produces output more suitable for talking to
services that expect JSON in a predefined format. Examples of these are</p>
<pre><code> Map output = serialization.write(address, new SimpleMapFormat());
 List output = serialization.write(address, new SimpleFlatFormat());
 var output = serialization.write(address, new SimpleJsonFormat());
</code></pre>
<p>Or, using a <a class="crossref" href="serialization/Writer.html">Writer</a> explicitly</p>
<pre><code> var writer = serialization.newWriter(new SimpleFlatFormat());
 List output = writer.write(address);
</code></pre>
<p>These representations are not yet considered stable.</p>
<h1>Reading</h1>
<p>To read objects, the corresponding <code>read</code> method can be used.</p>
<pre><code>  Address input = serialization.read(input);
</code></pre>
<p>When reading, the serialization instance doing the reading must be configured
with compatible rules to the one doing the writing. It's possible for the
rules to be different, but they need to be able to read the same
representation. For most practical purposes right now they should be the
same. The simplest way to achieve this is by having the serialization
variable <code>selfDescribing</code> be true. In that case the rules themselves are also
stored along with the serialized data, and can be read back on the receiving
end. Note that this may not work for all rules or all formats. The
<code>selfDescribing</code> variable is true by default, but the <a class="crossref" href="serialization/SimpleJsonFormat.html">SimpleJsonFormat</a> does
not support it, since the point is to provide a representation in a form
other services might expect. Using CustomRule or ClosureRule also does not
yet work with the <code>selfDescribing</code> variable.</p>
<h1>Named Objects</h1>
<p>When reading, some object references should not be serialized, but should be
connected up to other instances on the receiving side. A notable example of
this is when serialization rules have been stored. Instances of BasicRule
take a <code>ClassMirror</code> in their constructor, and we cannot serialize those. So
when we read the rules, we must provide a Map&lt;String, Object> which maps from
the simple name of classes we are interested in to a <code>ClassMirror</code>. This can
be provided either in the <code>namedObjects</code> variable of the Serialization,
or as an additional parameter to the reading and writing methods on the
<a class="crossref" href="serialization/Reader.html">Reader</a> or <a class="crossref" href="serialization/Writer.html">Writer</a> respectively.</p>
<pre><code>new Serialization()
  ..addRuleFor(new Person(), constructorFields: ["name"])
  ..namedObjects['Person'] = reflect(new Person()).type;
</code></pre></div>
<div>
<h3>Abstract Classes</h3>
          <div class="type">
          <h4>
            <a href="serialization/CustomRule.html"><strong>CustomRule</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/Format.html"><strong>Format</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/ReaderOrWriter.html"><strong>ReaderOrWriter</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/SerializationRule.html"><strong>SerializationRule</strong></a>
          </h4>
          </div>
          
</div>
<div>
<h3>Classes</h3>
          <div class="type">
          <h4>
            <a href="serialization/BasicRule.html"><strong>BasicRule</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/ClosureRule.html"><strong>ClosureRule</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/Constructor.html"><strong>Constructor</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/DesignatedRuleForObject.html"><strong>DesignatedRuleForObject</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/ListRule.html"><strong>ListRule</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/ListRuleEssential.html"><strong>ListRuleEssential</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/MapRule.html"><strong>MapRule</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/MirrorRule.html"><strong>MirrorRule</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/NamedObjectRule.html"><strong>NamedObjectRule</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/PrimitiveRule.html"><strong>PrimitiveRule</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/Reader.html"><strong>Reader</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/Reference.html"><strong>Reference</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/Serialization.html"><strong>Serialization</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/SimpleFlatFormat.html"><strong>SimpleFlatFormat</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/SimpleJsonFormat.html"><strong>SimpleJsonFormat</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/SimpleMapFormat.html"><strong>SimpleMapFormat</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/Trace.html"><strong>Trace</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/Writer.html"><strong>Writer</strong></a>
          </h4>
          </div>
          
</div>
<div>
<h3>Typedefs</h3>
          <div class="type">
          <h4>
            <a href="serialization/ConstructType.html"><strong>ConstructType</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/GetStateType.html"><strong>GetStateType</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/NonEssentialStateType.html"><strong>NonEssentialStateType</strong></a>
          </h4>
          </div>
          
          <div class="type">
          <h4>
            <a href="serialization/SetWithFunction.html"><strong>SetWithFunction</strong></a>
          </h4>
          </div>
          
</div>
<div>
<h3>Exceptions</h3>
          <div class="type">
          <h4>
            <a href="serialization/SerializationException.html"><strong>SerializationException</strong></a>
          </h4>
          </div>
          
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          <div>This page was generated at 2013-02-26 14:53:05.464</div>
<div>        <p>Except as otherwise <a href="http://code.google.com/policies.html#restrictions">noted</a>, the content of this
        page is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution
        3.0 License</a>, and code samples are licensed under the
        <a href="http://code.google.com/google_bsd_license.html">BSD License</a>.</p>
        <p><a href="http://www.dartlang.org/tos.html">Terms of Service</a> |
        <a href="http://www.google.com/intl/en/privacy/privacy-policy.html">Privacy Policy</a></p>
        </div>
        </div>
        <script async src="client-static.js"></script>
        </body></html>
        
